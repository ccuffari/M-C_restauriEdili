<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marocco&Cuffari - Gestione Fornitori</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/fornitori.css">
    <link rel="stylesheet" href="styles/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="dashboard-page" id="dashboardPage">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="navbar-container">
                <div class="navbar-brand">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="logo">
                        <i class="fas fa-hard-hat"></i>
                        <span>Marocco<span class="logo-highlight">&</span>Cuffari</span>
                    </div>
                </div>
                
                <div class="navbar-user">
                    <div class="user-info" id="userDropdownToggle">
                        <div class="user-avatar" id="userAvatar">
                            <!-- Initials will be set by JavaScript -->
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Caricamento...</div>
                            <div class="user-role" id="userRole">Caricamento...</div>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <a href="index.html">
                            <i class="fas fa-home"></i>
                            Dashboard Principale
                        </a>
                        <a href="cantieri.html">
                            <i class="fas fa-hard-hat"></i>
                            Gestione Cantieri
                        </a>
                        <a href="lavoro.html">
                            <i class="fas fa-calendar-alt"></i>
                            Giornate Lavorative
                        </a>
                        <a href="fatture.html">
                            <i class="fas fa-file-invoice"></i>
                            Fatture
                        </a>
                        <a href="preventivi.html">
                            <i class="fas fa-file-contract"></i>
                            Preventivi
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            Esci
                        </a>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Container -->
        <div class="main-container">
            <!-- La sidebar verrà caricata dinamicamente -->
            
            <div class="page-content" id="mainContent">
                <!-- Alert Container -->
                <div id="alertContainer"></div>
                
                <!-- Page Header -->
                <div class="page-header">
                    <h1><i class="fas fa-truck"></i> Gestione Fornitori</h1>
                    <div class="header-actions">
                        <button class="btn btn-success" id="addFornitoreBtn">
                            <i class="fas fa-plus"></i>
                            Nuovo Fornitore
                        </button>
                    </div>
                </div>
                
                <!-- Stats Overview -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="color: var(--accent);">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-number" id="totalFornitori">0</div>
                        <div class="stat-label">Fornitori Totali</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-number" id="fornitoriAttivi">0</div>
                        <div class="stat-label">Attivi</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-number" id="fornitoriInattivi">0</div>
                        <div class="stat-label">Inattivi</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="color: var(--info);">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-number" id="fornitoriMateriali">0</div>
                        <div class="stat-label">Fornitori Materiali</div>
                    </div>
                </div>
                
                <!-- Filtri -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-filter"></i> Filtri</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="form-group">
                                <label for="filterTipo">Tipo Fornitore</label>
                                <select id="filterTipo" class="form-control">
                                    <option value="all">Tutti i tipi</option>
                                    <option value="MATERIALI">Materiali</option>
                                    <option value="SERVIZI">Servizi</option>
                                    <option value="MANODOPERA">Manodopera</option>
                                    <option value="ATTREZZATURE">Attrezzature</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="filterStato">Stato</label>
                                <select id="filterStato" class="form-control">
                                    <option value="all">Tutti gli stati</option>
                                    <option value="ATTIVO">Attivo</option>
                                    <option value="INATTIVO">Inattivo</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="filterCitta">Città</label>
                                <input type="text" id="filterCitta" placeholder="Tutte le città" class="form-control">
                            </div>
                            
                            <div class="form-group" style="align-self: flex-end;">
                                <button class="btn btn-primary" id="applyFiltersBtn">
                                    <i class="fas fa-search"></i>
                                    Applica Filtri
                                </button>
                                <button class="btn btn-secondary" id="resetFiltersBtn">
                                    <i class="fas fa-redo"></i>
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabella fornitori -->
                <div class="content-card">
                    <div class="card-header">
                        <h3><i class="fas fa-list"></i> Elenco Fornitori</h3>
                        <div style="width: 300px;">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="fornitoriSearch" placeholder="Cerca fornitore...">
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="data-table-wrapper">
                            <table class="data-table" id="fornitoriTable">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Tipo</th>
                                        <th>Stato</th>
                                        <th>Partita IVA</th>
                                        <th>Email</th>
                                        <th>Telefono</th>
                                        <th>Città</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody id="fornitoriTableBody">
                                    <!-- Fornitori caricate dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                        <div id="fornitoriLoading" class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Caricamento fornitori...</p>
                        </div>
                        <div id="noFornitoriMessage" class="text-center" style="display: none; padding: 2rem;">
                            <i class="fas fa-truck" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <h4>Nessun fornitore presente</h4>
                            <p>Inizia aggiungendo il tuo primo fornitore utilizzando il pulsante "Nuovo Fornitore"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modale per aggiungere/modificare fornitore -->
    <div class="modal" id="fornitoreModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="fornitoreModalTitle"><i class="fas fa-plus"></i> Nuovo Fornitore</h3>
                <button class="modal-close" id="closeFornitoreModal">&times;</button>
            </div>
            <form id="fornitoreForm">
                <div class="modal-body">
                    <div id="fornitoreAlert" class="alert hidden"></div>
                    <input type="hidden" id="fornitoreId">
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreNome">Nome Fornitore *</label>
                            <input type="text" id="fornitoreNome" placeholder="Es: Edilferro Spa" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitoreTipo">Tipo *</label>
                            <select id="fornitoreTipo" required>
                                <option value="">Seleziona tipo...</option>
                                <option value="MATERIALI">Materiali</option>
                                <option value="SERVIZI">Servizi</option>
                                <option value="MANODOPERA">Manodopera</option>
                                <option value="ATTREZZATURE">Attrezzature</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreStato">Stato *</label>
                            <select id="fornitoreStato" required>
                                <option value="ATTIVO">Attivo</option>
                                <option value="INATTIVO">Inattivo</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitorePartitaIva">Partita IVA</label>
                            <input type="text" id="fornitorePartitaIva" placeholder="12345678901">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreCodiceFiscale">Codice Fiscale</label>
                            <input type="text" id="fornitoreCodiceFiscale" placeholder="RSSMRA85M01H501Z">
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitoreEmail">Email *</label>
                            <input type="email" id="fornitoreEmail" placeholder="fornitore@esempio.it" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreTelefono">Telefono</label>
                            <input type="tel" id="fornitoreTelefono" placeholder="+39 012 3456789">
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitoreSitoWeb">Sito Web</label>
                            <input type="url" id="fornitoreSitoWeb" placeholder="https://www.esempio.it">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreIndirizzo">Indirizzo</label>
                            <input type="text" id="fornitoreIndirizzo" placeholder="Via Roma, 123">
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitoreCitta">Città</label>
                            <input type="text" id="fornitoreCitta" placeholder="Milano">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label for="fornitoreCap">CAP</label>
                            <input type="text" id="fornitoreCap" placeholder="20100">
                        </div>
                        
                        <div class="form-group">
                            <label for="fornitoreProvincia">Provincia</label>
                            <input type="text" id="fornitoreProvincia" placeholder="MI" maxlength="2">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fornitoreNote">Note</label>
                        <textarea id="fornitoreNote" rows="3" placeholder="Informazioni aggiuntive sul fornitore..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelFornitore">Annulla</button>
                    <button type="submit" class="btn btn-primary" id="submitFornitore">
                        <i class="fas fa-save"></i>
                        Salva Fornitore
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="scripts/loadSidebar.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA7JiQrPYfvkRWZtdXQFw2Hj2LK0aidXYs",
            authDomain: "work-tracker-v120400.firebaseapp.com",
            projectId: "work-tracker-v120400",
            storageBucket: "work-tracker-v120400.firebasestorage.app",
            messagingSenderId: "437459935839",
            appId: "1:437459935839:web:cb0b54608314dcb25731ea",
            measurementId: "G-2LPKL9WREX"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Variabili globali
        let currentUser = null;
        let currentUserData = null;
        let allFornitori = [];
        let currentFilters = {
            tipo: 'all',
            stato: 'all',
            citta: ''
        };
        
        // DOM elements
        const addFornitoreBtn = document.getElementById('addFornitoreBtn');
        const fornitoriTableBody = document.getElementById('fornitoriTableBody');
        const fornitoreModal = document.getElementById('fornitoreModal');
        const fornitoreForm = document.getElementById('fornitoreForm');
        const closeFornitoreModal = document.getElementById('closeFornitoreModal');
        const cancelFornitore = document.getElementById('cancelFornitore');
        
        // Stats elements
        const totalFornitori = document.getElementById('totalFornitori');
        const fornitoriAttivi = document.getElementById('fornitoriAttivi');
        const fornitoriInattivi = document.getElementById('fornitoriInattivi');
        const fornitoriMateriali = document.getElementById('fornitoriMateriali');
        
        // Filter elements
        const filterTipo = document.getElementById('filterTipo');
        const filterStato = document.getElementById('filterStato');
        const filterCitta = document.getElementById('filterCitta');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const fornitoriSearch = document.getElementById('fornitoriSearch');
        
        // Initialize app
        function initApp() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await loadUserData(user.uid);
                    showDashboard();
                } else {
                    window.location.href = 'index.html';
                }
            });
            
            // Event listeners
            addFornitoreBtn.addEventListener('click', () => {
                document.getElementById('fornitoreModalTitle').innerHTML = '<i class="fas fa-plus"></i> Nuovo Fornitore';
                fornitoreForm.reset();
                document.getElementById('fornitoreAlert').classList.add('hidden');
                document.getElementById('fornitoreId').value = '';
                document.getElementById('fornitoreStato').value = 'ATTIVO';
                fornitoreModal.classList.add('show');
            });
            
            closeFornitoreModal.addEventListener('click', () => {
                fornitoreModal.classList.remove('show');
            });
            
            cancelFornitore.addEventListener('click', () => {
                fornitoreModal.classList.remove('show');
            });
            
            fornitoreForm.addEventListener('submit', saveFornitore);
            
            // Filtri
            applyFiltersBtn.addEventListener('click', applyFilters);
            resetFiltersBtn.addEventListener('click', resetFilters);
            fornitoriSearch.addEventListener('input', filterFornitori);
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                });
            });
        }
        
        function showDashboard() {
            updateUserDisplay();
            loadFornitori();
        }
        
        function loadUserData(uid) {
            return db.collection('users').doc(uid).get().then(doc => {
                if (doc.exists) {
                    currentUserData = doc.data();
                }
            });
        }
        
        function updateUserDisplay() {
            if (currentUserData) {
                document.getElementById('userName').textContent = currentUserData.name;
                document.getElementById('userRole').textContent = currentUserData.role;
                document.getElementById('userAvatar').textContent = 
                    currentUserData.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            }
        }
        
        // Carica fornitori
        async function loadFornitori() {
            fornitoriTableBody.innerHTML = '';
            document.getElementById('fornitoriLoading').classList.remove('hidden');
            document.getElementById('noFornitoriMessage').style.display = 'none';
            
            try {
                let query = db.collection('fornitori');
                
                // Applica filtri
                if (currentFilters.tipo !== 'all') {
                    query = query.where('tipo', '==', currentFilters.tipo);
                }
                
                if (currentFilters.stato !== 'all') {
                    query = query.where('stato', '==', currentFilters.stato);
                }
                
                const snapshot = await query.orderBy('nome').get();
                allFornitori = [];
                
                let totalAttivi = 0;
                let totalInattivi = 0;
                let totalMateriali = 0;
                
                snapshot.forEach(doc => {
                    const fornitore = doc.data();
                    const fornitoreId = doc.id;
                    
                    // Applica filtro città se specificato
                    if (currentFilters.citta && 
                        fornitore.citta && 
                        !fornitore.citta.toLowerCase().includes(currentFilters.citta.toLowerCase())) {
                        return;
                    }
                    
                    allFornitori.push({ id: fornitoreId, ...fornitore });
                    
                    // Calcola statistiche
                    if (fornitore.stato === 'ATTIVO') totalAttivi++;
                    if (fornitore.stato === 'INATTIVO') totalInattivi++;
                    if (fornitore.tipo === 'MATERIALI') totalMateriali++;
                    
                    // Crea riga tabella
                    const row = document.createElement('tr');
                    
                    let statoBadge = '';
                    if (fornitore.stato === 'ATTIVO') {
                        statoBadge = '<span class="badge-active">Attivo</span>';
                    } else {
                        statoBadge = '<span class="badge-inactive">Inattivo</span>';
                    }
                    
                    let tipoBadge = '';
                    switch(fornitore.tipo) {
                        case 'MATERIALI':
                            tipoBadge = '<span class="badge-materiali">Materiali</span>';
                            break;
                        case 'SERVIZI':
                            tipoBadge = '<span class="badge-servizi">Servizi</span>';
                            break;
                        case 'MANODOPERA':
                            tipoBadge = '<span class="badge-manodopera">Manodopera</span>';
                            break;
                        case 'ATTREZZATURE':
                            tipoBadge = '<span class="badge-attrezzature">Attrezzature</span>';
                            break;
                        default:
                            tipoBadge = `<span class="badge-default">${fornitore.tipo}</span>`;
                    }
                    
                    row.innerHTML = `
                        <td><strong>${fornitore.nome || 'N/D'}</strong></td>
                        <td>${tipoBadge}</td>
                        <td>${statoBadge}</td>
                        <td>${fornitore.partita_iva || '-'}</td>
                        <td>${fornitore.email ? `<a href="mailto:${fornitore.email}">${fornitore.email}</a>` : '-'}</td>
                        <td>${fornitore.telefono || '-'}</td>
                        <td>${fornitore.citta || '-'}</td>
                        <td>
                            <button class="btn btn-icon edit-fornitore-btn" data-id="${fornitoreId}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-icon delete-fornitore-btn" data-id="${fornitoreId}" data-nome="${fornitore.nome}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    fornitoriTableBody.appendChild(row);
                });
                
                // Aggiorna statistiche
                totalFornitori.textContent = allFornitori.length;
                fornitoriAttivi.textContent = totalAttivi;
                fornitoriInattivi.textContent = totalInattivi;
                fornitoriMateriali.textContent = totalMateriali;
                
                // Aggiungi event listeners per i pulsanti
                document.querySelectorAll('.edit-fornitore-btn').forEach(btn => {
                    btn.addEventListener('click', () => editFornitore(btn.getAttribute('data-id')));
                });
                
                document.querySelectorAll('.delete-fornitore-btn').forEach(btn => {
                    btn.addEventListener('click', () => deleteFornitore(
                        btn.getAttribute('data-id'),
                        btn.getAttribute('data-nome')
                    ));
                });
                
                // Mostra messaggio se non ci sono fornitori
                if (allFornitori.length === 0) {
                    document.getElementById('fornitoriLoading').classList.add('hidden');
                    document.getElementById('noFornitoriMessage').style.display = 'block';
                } else {
                    document.getElementById('fornitoriLoading').classList.add('hidden');
                }
                
            } catch (error) {
                console.error('Error loading fornitori:', error);
                showAlert('error', 'Errore nel caricamento dei fornitori');
                document.getElementById('fornitoriLoading').classList.add('hidden');
                document.getElementById('noFornitoriMessage').style.display = 'block';
            }
        }
        
        // Salva fornitore
        async function saveFornitore(e) {
            e.preventDefault();
            
            const fornitoreId = document.getElementById('fornitoreId').value;
            
            const submitBtn = document.getElementById('submitFornitore');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvataggio...';
            submitBtn.disabled = true;
            
            try {
                // Prepara dati fornitore
                const fornitoreData = {
                    nome: document.getElementById('fornitoreNome').value,
                    tipo: document.getElementById('fornitoreTipo').value,
                    stato: document.getElementById('fornitoreStato').value,
                    partita_iva: document.getElementById('fornitorePartitaIva').value || '',
                    codice_fiscale: document.getElementById('fornitoreCodiceFiscale').value || '',
                    email: document.getElementById('fornitoreEmail').value,
                    telefono: document.getElementById('fornitoreTelefono').value || '',
                    sito_web: document.getElementById('fornitoreSitoWeb').value || '',
                    indirizzo: document.getElementById('fornitoreIndirizzo').value || '',
                    citta: document.getElementById('fornitoreCitta').value || '',
                    cap: document.getElementById('fornitoreCap').value || '',
                    provincia: document.getElementById('fornitoreProvincia').value || '',
                    note: document.getElementById('fornitoreNote').value || '',
                    updatedAt: new Date().toISOString(),
                    updatedBy: currentUser.uid
                };
                
                // Validazione campi obbligatori
                if (!fornitoreData.nome || !fornitoreData.tipo || !fornitoreData.stato || !fornitoreData.email) {
                    showModalAlert(fornitoreAlert, 'error', 'I campi Nome, Tipo, Stato e Email sono obbligatori');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Salva Fornitore';
                    submitBtn.disabled = false;
                    return;
                }
                
                // Salva su Firestore
                if (fornitoreId) {
                    // Aggiornamento
                    await db.collection('fornitori').doc(fornitoreId).update(fornitoreData);
                } else {
                    // Nuovo fornitore
                    fornitoreData.createdAt = new Date().toISOString();
                    fornitoreData.createdBy = currentUser.uid;
                    await db.collection('fornitori').add(fornitoreData);
                }
                
                // Chiudi modal e ricarica
                fornitoreModal.classList.remove('show');
                loadFornitori();
                showAlert('success', fornitoreId ? 'Fornitore aggiornato!' : 'Fornitore creato!');
                
            } catch (error) {
                console.error('Error saving fornitore:', error);
                showModalAlert(fornitoreAlert, 'error', 'Errore durante il salvataggio');
            } finally {
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Salva Fornitore';
                submitBtn.disabled = false;
            }
        }
        
        // Modifica fornitore
        function editFornitore(id) {
            const fornitore = allFornitori.find(f => f.id === id);
            if (!fornitore) return;
            
            // Popola form
            document.getElementById('fornitoreId').value = id;
            document.getElementById('fornitoreNome').value = fornitore.nome || '';
            document.getElementById('fornitoreTipo').value = fornitore.tipo || '';
            document.getElementById('fornitoreStato').value = fornitore.stato || 'ATTIVO';
            document.getElementById('fornitorePartitaIva').value = fornitore.partita_iva || '';
            document.getElementById('fornitoreCodiceFiscale').value = fornitore.codice_fiscale || '';
            document.getElementById('fornitoreEmail').value = fornitore.email || '';
            document.getElementById('fornitoreTelefono').value = fornitore.telefono || '';
            document.getElementById('fornitoreSitoWeb').value = fornitore.sito_web || '';
            document.getElementById('fornitoreIndirizzo').value = fornitore.indirizzo || '';
            document.getElementById('fornitoreCitta').value = fornitore.citta || '';
            document.getElementById('fornitoreCap').value = fornitore.cap || '';
            document.getElementById('fornitoreProvincia').value = fornitore.provincia || '';
            document.getElementById('fornitoreNote').value = fornitore.note || '';
            
            document.getElementById('fornitoreModalTitle').innerHTML = '<i class="fas fa-edit"></i> Modifica Fornitore';
            fornitoreModal.classList.add('show');
        }
        
        // Elimina fornitore
        async function deleteFornitore(id, nome) {
            if (!confirm(`Sei sicuro di voler eliminare il fornitore "${nome}"?`)) return;
            
            try {
                await db.collection('fornitori').doc(id).delete();
                loadFornitori();
                showAlert('success', 'Fornitore eliminato!');
            } catch (error) {
                console.error('Error deleting fornitore:', error);
                showAlert('error', 'Errore durante l\'eliminazione');
            }
        }
        
        function applyFilters() {
            currentFilters.tipo = filterTipo.value;
            currentFilters.stato = filterStato.value;
            currentFilters.citta = filterCitta.value;
            loadFornitori();
        }
        
        function resetFilters() {
            filterTipo.value = 'all';
            filterStato.value = 'all';
            filterCitta.value = '';
            applyFilters();
        }
        
        function filterFornitori() {
            const term = fornitoriSearch.value.toLowerCase();
            const rows = fornitoriTableBody.querySelectorAll('tr');
            let hasVisibleRows = false;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const isVisible = text.includes(term);
                row.style.display = isVisible ? '' : 'none';
                if (isVisible) hasVisibleRows = true;
            });
            
            // Mostra messaggio se nessun risultato
            if (!hasVisibleRows && allFornitori.length > 0) {
                if (!document.getElementById('noResultsMessage')) {
                    const noResults = document.createElement('tr');
                    noResults.id = 'noResultsMessage';
                    noResults.innerHTML = `
                        <td colspan="8" class="text-center" style="padding: 2rem;">
                            <i class="fas fa-search" style="font-size: 2rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <h4>Nessun risultato trovato</h4>
                            <p>Prova a modificare i criteri di ricerca</p>
                        </td>
                    `;
                    fornitoriTableBody.appendChild(noResults);
                }
            } else {
                const noResults = document.getElementById('noResultsMessage');
                if (noResults) noResults.remove();
            }
        }
        
        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.getElementById('alertContainer').innerHTML = '';
            document.getElementById('alertContainer').appendChild(alert);
            
            setTimeout(() => alert.remove(), 5000);
        }
        
        function showModalAlert(container, type, message) {
            container.textContent = message;
            container.className = `alert alert-${type}`;
            container.classList.remove('hidden');
        }
        
        // Inizializza app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-container">
            <p>&copy; <span id="currentYear">2024</span> Marocco&Cuffari Ristauri Edili</p>
            <p class="developer-credit">Sviluppato da Cristian Felice Cuffari</p>
        </div>
    </footer>
    
    <script>
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    </script>
</body>
</html>